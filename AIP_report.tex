\documentclass[12pt,a4j]{jsarticle}

\usepackage{bm}	% ベクトル修飾の太字がキレイに出せる
\usepackage{mathrsfs}	% 飾文字
\usepackage{amsmath,amssymb} % 数学系

\newcommand{\xa}{x_\alpha}
\newcommand{\bxa}{\bar{x}_\alpha}
\newcommand{\dxa}{\Delta x_\alpha}
\newcommand{\ya}{y_\alpha}
\newcommand{\bya}{\bar{y}_\alpha}
\newcommand{\dya}{\Delta y_\alpha}
\newcommand{\xia}{\bm{\xi}_\alpha}
\newcommand{\bxia}{\bar{\bm{\xi}}_\alpha}

\title{画像工学特論 レポート}
\author{163377 宮田木織}

\begin{document}
  \maketitle % タイトルを出力

\section*{課題2}
  式と式番号を以下のように置きなおす。

  \begin{align}
    \xia &= \begin{pmatrix}\xa^2 & 2\xa\ya & \ya^2 & 2f_0\xa & 2f_0\ya & f_0^2\end{pmatrix}^\top
     & \quad\cdots\text{誤差を含む点データ} \\
    \bxia &= \begin{pmatrix}\bxa^2 & 2\bxa\bya & \bya^2 & 2f_0\bxa & 2f_0\bya & f_0^2\end{pmatrix}^\top
     & \quad\cdots\text{$\xa$と$\ya$を真値とした$\xia$} \\
    \bm{u} &= \begin{pmatrix}A & B & C & D & E & F\end{pmatrix}^\top
     & \quad\cdots\text{楕円のパラメータ} \\
    \bm{M} &= \sum_{\alpha = 1}^N \xia \xia^\top
     & \quad\cdots\text{レポート問題文中式(2)より} \label{eq:M}
  \end{align}

  \subsection*{2-1}
  最小二乗法は、誤差の性質を考慮せず、素朴な考え方で楕円のパラメータ$\bm{u}$を推測する手法である。\par
  まず、楕円の性質より、全ての$\bxia$について下式が成り立つ。

  \begin{equation}
    (\bm{u}, \bxia) = 0 \label{eq:uxia0}
  \end{equation}

  ここから単純に考えると、$\xia$に関しては、下式の$(\bm{u}, \xia)$の2乗和$J_{LS}$が最小となるような$\bm{u}$がパラメータとして最もらしいと言える。

  \begin{equation}
    J_{LS} = \sum_{\alpha = 1}^N (\bm{u}, \xia)^2 \label{eq:JLS}
  \end{equation}

  最小二乗法は、この考えに基づき、$J_{LS}$を目的関数として最小化することで、$\bm{u}$を推測する手法である。\par
  ここで、式(\ref{eq:JLS})を展開・整理すると下式となる。

  \begin{align}
    \sum_{\alpha = 1}^N (\bm{u}, \xia)^2 &= \sum_{\alpha = 1}^N (\xia, \bm{u})^2 \nonumber \\
     &= \sum_{\alpha = 1}^N \xia^\top \bm{u} \xia^\top \bm{u} \nonumber \\
     &= \sum_{\alpha = 1}^N \bm{u}^\top \xia \xia^\top \bm{u} \nonumber \\
     &= \bm{u}^\top \left(\sum_{\alpha = 1}^N \xia \xia^\top \right) \bm{u} \label{eq:organized}
  \end{align}

  式(\ref{eq:organized})を式(\ref{eq:M})を用いて置きなおすことで、$J_{LS}$は以下のように書くことができる。

  \begin{equation}
    J_{LS} = (\bm{u}, \bm{Mu})
  \end{equation}

  以上のとおり、最小二乗法で楕円のパラメータを推定するときの目的関数$J_{LS}$が示された。

  \subsection*{2-2}
    最尤推定は、$\xia$の誤差の確率的な性質を考え、マハラノビス距離（各$\xia$と楕円との幾何学的距離の総和に等しい）を最小化することで楕円のパラメータ$\bm{u}$を推定する手法である。
  
    \subsubsection*{誤差と共分散行列}
      誤差が互いに独立な期待値$0$、標準偏差$\sigma$の正規分布に従うと考え、共分散行列を定義する。\par
      まず、$\xa$と$\ya$は、それぞれを真値と誤差の和として以下のように表せる。

      \begin{equation}
        \xa = \bxa + \dxa, \quad \ya = \bya + \dya
      \end{equation}

      これを用いて$\xia$を表すと、以下のようになる。
      \begin{equation}
        \xia = \bxia + \Delta_1\xia + \Delta_2\xia
      \end{equation}
      \begin{align}
        \Delta_1\xia &= \begin{pmatrix}2\bxa\dxa & 2\dxa\bya + 2\bxa\dya & 2\bya\dya & 2f_0\dxa & 2f_0\dya & 0\end{pmatrix}^\top \\
        \Delta_2\xia &= \begin{pmatrix}\dxa^2 & 2\dxa\dya & \dya^2 & 0 & 0 & 0 \end{pmatrix}^\top
      \end{align}

      ここで、誤差が確率変数であるとみなし、$\xia$の共分散行列を下式のように定義する。ただし、$\Delta_2\xia$は十分に小さいものとして無視している。
      \begin{align}
        V[\xia] &= E[\Delta_1\xia\Delta_1\xia^\top] \\
        \Delta_1\xia\Delta_1\xia^\top &= 4\begin{pmatrix}
          \bm{a} & \bm{b} & \bm{c} & \bm{d} & \bm{e} & \bm{f}
        \end{pmatrix}
      \end{align}

      \begin{align*}
        \bm{a} = \begin{pmatrix}
          \bxa^2\dxa^2 \\ \bxa\bya\dxa^2 + \bxa^2\dxa\dya \\
          \bxa\bya\dxa\dya \\ f_0\bxa\dxa^2 \\
          f_0\bxa\dxa\dya \\ 0
        \end{pmatrix}, \quad& \bm{b} = \begin{pmatrix}
          \bxa\bya\dxa^2 + \bxa^2\dxa\dya \\ \dxa^2\bya^2 + 2\bxa\bya\dxa\dya + \bxa^2\dya^2 \\
          \bya^2\dxa\dya + \bxa\bya\dya^2 \\ f_0(\dxa^2\bya + \bxa\dxa\dya) \\
          f_0(\bya\dxa\dya + \bxa\dya^2) \\ 0
        \end{pmatrix} \\
        \bm{c} = \begin{pmatrix}
          \bxa\bya\dxa\dya \\ \bya^2\dxa\dya + \bxa\bya\dya^2 \\
          \bya^2\dya^2 \\ f_0\bya\dxa\dya \\
          f_0\bya\dya^2 \\ 0
        \end{pmatrix} ,\quad& \bm{d} = \begin{pmatrix}
          f_0\bxa\dxa^2 \\ f_0(\dxa^2\bya + \bxa\dxa\dya) \\
          f_0\bya\dxa\dya \\ f_0^2\dxa^2 \\
          f_0^2\dxa\dya \\ 0
        \end{pmatrix} \\
        \bm{e} = \begin{pmatrix}
          f_0\bxa\dxa\dya \\ f_0(\bya\dxa\dya + \bxa\dya^2) \\
          f_0\bya\dya^2 \\ f_0^2\dxa\dya \\
          f_0^2\dya^2 \\ 0
        \end{pmatrix} ,\quad& \bm{f} = \begin{pmatrix}
          0 \\ 0 \\
          0 \\ 0 \\
          0 \\ 0
        \end{pmatrix}
      \end{align*}

      更に、誤差が互いに独立な期待値$0$、標準偏差$\sigma$の正規分布に従うなら、
      \begin{equation}
        E[\dxa] = E[\dya] = E[\dxa\dya] = 0, \quad E[\dxa^2] = E[\dya^2] = \sigma
      \end{equation}
      であるため、共分散行列は以下のように書ける。$V_0[\xia]$は、共分散行列から$\sigma^2$を括りだしたもので、正規化共分散行列という。

      \begin{align}
        V[\xia] &= 4 \begin{pmatrix}
          \sigma^2\bxa^2 & \sigma^2\bxa\bya & 0 & f_0\sigma^2\bxa & 0 & 0 \\
          \sigma^2\bxa\bya & \sigma^2(\bya^2 + \bxa^2) & \sigma^2\bxa\bya & f_0\sigma^2\bya & f_0\sigma^2\bxa & 0 \\
          0 & \sigma^2\bxa\bya & \sigma^2\bya^2 & 0 & f_0\sigma^2\bya & 0 \\
          f_0\sigma^2\bxa & f_0\sigma^2\bya & 0 & f_0^2\sigma^2 & 0 & 0 \\
          0 & f_0\sigma^2\bxa & f_0\sigma^2\bya & 0 & f_0^2\sigma^2 & 0 \\
          0 & 0 & 0 & 0 & 0 & 0 \\
        \end{pmatrix} \\
         &= \sigma^2 V_0[\xia] 
      \end{align}
    
    \subsubsection*{最尤推定}
      ここまでで求めた共分散行列を用い、マハラノビス距離を以下のように定義する。
      \begin{equation}
        J = \sum_{\alpha = 1}^N \left(\xia - \bxia, V[\xia]^{-1} (\xia - \bxia) \right)
      \end{equation}
      
      これを式(\ref{eq:uxia0})を制約条件としてラグランジュ乗数を導入し、最小化する。\par
      ラグランジュ関数は
      \begin{equation}
        L = \sum_{\alpha = 1}^N \left(\xia - \bxia, V[\xia]^{-1} (\xia - \bxia) \right) - \sum_{\alpha = 1}^N \lambda_\alpha (\bxia, \bm{u})
      \end{equation}
      であり、これを$\lambda_\alpha$と$\bxia$でそれぞれ偏微分すると
      \begin{equation}
        \frac{\partial L}{\partial \bxia} = \frac{\partial L}{\partial \lambda_\alpha} = 0
      \end{equation}
      となる。
\end{document}
